Voglio trasformare la  trasformare la mia app da manuale ad automatica.
Di seguito le istruzioni corrette del bot: 

Logiche Corrette del Bot
ğŸ¯ FASE 1: Condizioni di Entrata (SOLO quando utente clicca START)
Trigger: Utente clicca START
Controlli:
â“ C'Ã¨ giÃ  un bot attivo per questo utente? NO
â“ L'utente ha abbastanza capitale sugli exchange selezionati? SÃŒ
âœ… Se tutto OK â†’ Apre posizioni LONG + SHORT IMMEDIATAMENTE

âœ… NESSUN controllo di funding rate o condizioni di mercato
âœ… NESSUN monitoraggio continuo per entrata
âœ… SOLO: bot non attivo + capitale sufficiente = APRI SUBITO
ğŸ¯ FASE 2: Monitoraggio Continuo (ogni 10 secondi)
SOLO DOPO che le posizioni sono aperte, ogni 10 secondi:
ğŸ‘ï¸ Controlla livelli di rischio (prezzo vs liquidation price)
âŒ NON controlla P&L
âŒ NON controlla funding rates  
âŒ NON controlla altri parametri

Focus: SOLO sicurezza posizioni (distanza da liquidazione)
ğŸ¯ FASE 3: Decisioni Automatiche
Il bot decide automaticamente di:
ğŸšª CHIUDERE TUTTE le posizioni quando:
   - Livello di rischio > soglia predeterminata
   - (Prezzo troppo vicino a liquidation price)
   
âŒ NO take profit automatici
âŒ NO stop loss in USDT
âœ… SOLO stop di emergenza per evitare liquidazione
ğŸ¯ FASE 4: Riapertura Automatica
Dopo chiusura posizioni:
ğŸ”„ Ricontrolla condizioni FASE 1:
   - Bot attivo? (rimane SÃŒ)
   - Capitale sufficiente? 
ğŸ”„ Se OK â†’ Riapre nuove posizioni IMMEDIATAMENTE
ğŸ”„ Ripete il ciclo infinitamente fino a STOP utente
ğŸ¯ FASE 5: Bilanciamento Margine (2 volte al giorno)
Controllo automatico indipendente (CronJob 12:00 e 00:00):

Condizione: Bot attivo per l'utente
Controllo:
ğŸ‘ï¸ Margine posizione Exchange A vs Exchange B
ğŸ‘ï¸ Se margine sproporzionato (es. differenza >20%):
   - Rimuovi margine da posizione con piÃ¹ margine
   - Trasferisci fondi all'altro exchange  
   - Aggiungi margine alla posizione con meno margine

âœ… Questo controllo Ã¨ SEPARATO dalle altre fasi
âœ… Non influenza il monitoraggio ogni 10 secondi
âœ… Solo se bot attivo
ğŸ—ï¸ Architettura Corretta
Moduli Necessari:
core/
â”œâ”€â”€ bot_engine.py          # Orchestrazione generale
â”œâ”€â”€ entry_manager.py       # FASE 1: Solo controlli entrata
â”œâ”€â”€ risk_monitor.py        # FASE 2: Solo controllo rischio liquidazione  
â”œâ”€â”€ emergency_closer.py    # FASE 3: Solo chiusura emergenza
â”œâ”€â”€ cycle_manager.py       # FASE 4: Gestione riapertura
â””â”€â”€ margin_balancer.py     # FASE 5: Bilanciamento margine (cronjob)
Timers Separati:
1. Loop principale ogni 10 secondi (FASE 2 + 3 + 4)
2. CronJob 2 volte al giorno (FASE 5)


ğŸ“‹ Riassunto Architettura Finale
ğŸ¯ Moduli Core (5 file principali)
core/bot_engine.py      # Orchestratore (150 righe)
core/entry_manager.py   # FASE 1: Entrata (100 righe)  
core/risk_monitor.py    # FASE 2: Monitoraggio rischio (80 righe)
core/emergency_closer.py # FASE 3: Chiusura emergenza (60 righe)
core/cycle_manager.py   # FASE 4: Riapertura (40 righe)
ğŸ•’ Servizi Background (2 file)
core/margin_balancer.py    # FASE 5: Bilanciamento margine (100 righe)
services/scheduler.py      # CronJob manager (50 righe)
ğŸ’¾ Database e Utility (3 file)
database/mongo_manager.py # Operazioni MongoDB (200 righe)
api/exchange_manager.py   # Wrapper exchange esistenti (150 righe)
main.py                   # Entry point + BotManager (80 righe)
ğŸ—„ï¸ Database MongoDB (7 collections)
users              # Configurazioni utenti e credenziali
bot_configs        # Configurazioni strategia per utente
bot_status         # Stato corrente bot (running/stopped)
active_positions   # Posizioni attive con risk monitoring
trade_history      # Storico operazioni
risk_events        # Log eventi di rischio
margin_balance_logs # Log bilanciamenti margine
âš¡ Flusso Operativo

Utente clicca START â†’ bot_status.status = "running"
BotManager rileva nuovo bot attivo â†’ Crea TradingBot(user_id)
TradingBot.start() â†’ Controlli + apertura immediata posizioni
Loop ogni 10 secondi â†’ Solo controllo rischio liquidazione
Se rischio alto â†’ Chiusura + tentativo riapertura
CronJob 2x/giorno â†’ Bilanciamento margine se necessario

Ho giÃ  inizializzato il DB e creato le collections. 